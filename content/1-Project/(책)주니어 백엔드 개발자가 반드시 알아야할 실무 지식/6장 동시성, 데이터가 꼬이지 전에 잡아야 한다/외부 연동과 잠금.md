---
tags:
  - lock
created: 2025-07-27
---
트랜잭션 범위 내에서 외부 시스템과 연동해야 한다면, [[비선점(낙관형) 잠금]]보다는 [[선점(비관적) 잠금]]을 고려하는 게좋다.

예를 들어, 주문 최소 과정에서 외부 PG 시스템을 호출해서 결제까지 함께 취소해야되는 상황 생각해보자. 이때 비선점 잠금 쓰면 이미 결제는 취소되었는데, 데이터 변경에 실패해서 트랜젝셩이 롤백되는 문제가 발생할 수 있다.
> 책의 177p, 그림6.10 참고!

비선점 잠금을 굳이 쓰려면 [[트랜잭션 아웃박스 패턴]]을 적용해서 외부 연동을 처리하는 방법도 존재.