---
tags: 
created: 2025-08-13
---
이제까지 신뢰적인 데이터 전송의 원칙을 다루었다. 이제 TCP~! 연결형, 신뢰적인 트랜스포트 프로토콜을 공부해보자.

## 3.5.1 TCP 연결
데이터 전송을 보장하는 파라미터들을 각자 설정하기 위해 세그먼트들을 보내야한다. 그래야 핸드셰이크가 되니깐.

TCP 연결은 회선 교환 네트워크에서와 같은 종단 간의 TDM이나 FDM이 아니다. 대신 연결은 두 종단 시스템의 TCP에 존재하는 상태를 공유하는 논리적인 것이다. TCP는 오직 종단에서만 동작하고 중간의 네트워크 요소(라우터, 링크 계층 스위치)에선 동작 않으므로, 중간의 네트워크 요소들은 TCP 연결 상태를 유지하지 않는다. 사실, 중간 라우터들은 TCP 연결을 전혀 감지 못한다. 즉, 이들은 연결은 보지 못하고 데이터그램만 본다.

TCP 연결은 전이중 서비스(full-duplex service)를 제공한다. 만약 호스트 a와 b사이에 TCP 연결이 있다면, 애플리케이션 계층 데이터는 b -> a, a -> b 가 동시에 가능하다! 또한 TCP 연결은 항상 단일 송신자와 단일 수신자 사이의 점대점이다. 단일 송신 동작으로 한 송신자가 여러 수신자에게 데이털르 전송하는 멀티캐스팅은 TCP에서는 불가하다. TCP에서 두 호스트는 동료고 셋은 만원이다.

이제 TCP 연결이 어케 설정되는지 보자. 한 호스트에서 동작하는 프로세스가 다른 호스트의 프로세스와 연결을 초기화하기를 원한다고 가정하자. 클라 프로세스는 서버의 프로세스와 연결을 설정하기 원한다고 TCP 클라에게 먼저 알린다. 2.7.2에서 파이썬 클라 프로그램에 다음 명령으로 이 기능 수행했음.

`clientSocket.connect((serverName, serverPort))`

클라의 트랜스포트 계층은 서버의 TCP와의 TCP 연결 설정을 진행한다. 이 절의 마지막에 연결 설정 절차를 자세히 설명함. 지금은 클라가 먼저 특별한 TCP 세그먼트를 보낸다는것을 아는 정도로 충분. 서버는 두 번째 특별한 TCP 세그먼트로 응답. 마지막으로, 클라가 세 번째 특별한 세그먼트로 응답한다. 처음 2개의 세그먼트에는 페이로드, 즉, 앱 계층 데이터가 없다. 세 번째 세그먼트는 페이로드를 포함할 수 있다. 두 호스트 사이에 3개의 세그먼트가 보내지므로 흔히 three way handshake 라 부른다.

일단 TCP 연결이 되면, 두 앱 프로세스는 서로 데이터를 보낼 수 있다. 클라 프로세스에서 서버 프로세스로의 데이터 송신을 고려해보자. 클라 프로세스는 소켓을 통해 데이터의 스트림을 전달한다. 데이터가 소켓 통해 전달되면, 이제 데이터는 클라에서 동작하고 있는 TCP에 맡겨진다. 그림 3.28에 보이듯이 TCP는 초기 세 방향 핸드셰이크 동안 준비된 버퍼중의 하나인 송신 버퍼로 데이터 보낸다. 때때로 TCP는 송신 버퍼에서 데이터 묶음을 만들어 네트워크로 보낸다. TCP 명세서(RFC 793)에서 TCP '자신이 편한 대로 세그먼트의 데이터를 전송'해야 한다고 기술하고 있으며, TCP가 언제 버퍼된 데이터를 전송해야하는지는 미기술되어있다. 세그먼트로 모아 담을 수 있는 최대 데이터 양은 최대 세그먼트 크기(maximum segement size, MSS)로 제한된다. MSS는 일반적으로 로컬 송신 호스트에 의해 전송될 수 있는 가장 큰 링크 계층 프레임의 길이(최대 전송 단위 maximum trasmission unit, MUT)에 의해 일단 결정되고, 후에 TCP 세그먼트와 TCP/IP 헤더 길이가 단일 링크 계층 프레임에 딱 맞도록 하여 정해진다. 이더넷과 PPP 링크 계층 프로토콜은 모두 1500 바이트의 MTU 갖는다. 따라서 MSS의 일반적 값은 1460바이트다. 출발지에서 목적지까지 모든 링크상에 전송될 수 있는 가장 큰 링크 계층 프레임인 경로 MTU를 찾고 이 경로 MTU 값에 근거한 MSS 설정을 위한 방식들도 제안되고 있다. MSS가 헤더를 포함하는 TCP 세그먼트의 최대 크기가 아니라, 세그먼트에 있는 앱 계층 데이터에 대한 최대 크기라는 점 주의(혼동되지만 우린 이 용어 써야됨)

![[SCR-20250813-rfpn.jpeg]]

TCP는 TCP 헤더와 클라이언트 데이터를 하나로 짝지어 TCP 세그먼트를 구성한다. TCP가 세그먼트를 수신했을 때, 그림 3.28처럼 세그먼트 데이터는 TCP 연결의 수신 버퍼에 위치한다. 앱은 이 버퍼로부터 데이터 스트림을 읽는다. 연결의 양 끝은 각각 자신의 송신 버퍼와 수신 버퍼 가지고있다.

TCP 연결은 한쪽 호스트에서의 버퍼, 변수, 프로세스에 대한 소켓 연결과 다른 쪽 호스트에서의 버퍼, 변수, 소켓 연결의 집합으로 이루어진다는 사실을 알 수 있다.

이런 버퍼, 변수 같은건 호스트 간 네트워크 요소인 라우터, 스위치, 리피터의 연결에는 해당 안된다.
