---
created: 2025-04-11
---
#docker #resouce-constraint

> https://docs.docker.com/engine/containers/resource_constraints
> https://www.baeldung.com/ops/docker-memory-limit

## **ì»¨í…Œì´ë„ˆ ë¦¬ì†ŒìŠ¤ ì œì•½ ê¸°ëŠ¥**

ê¸°ë³¸ì ìœ¼ë¡œ ì»¨í…Œì´ë„ˆëŠ” ìžì› ì œì•½ì´ ì—†ìœ¼ë©° í˜¸ìŠ¤íŠ¸ì˜ ì»¤ë„ ìŠ¤ì¼€ì¤„ëŸ¬ê°€ í—ˆìš©í•˜ëŠ”ë§Œí¼ ì£¼ì–´ì§„ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìžˆë‹¤. 

í•˜ì§€ë§Œ ë„ì»¤ëŠ” ì»¨í…Œì´ë„ˆê°€ ì“¸ìˆ˜ ìžˆëŠ” CPU, memory ìžì›ì„ ì»¨íŠ¸ë¡¤í•˜ëŠ” ëŸ°íƒ€ìž„ ì„¤ì •ì„ `docker run` ì»¤ë©˜ë“œì—ì„œ ì œê³µí•œë‹¤. 

ì´ ì œì•½ê¸°ëŠ¥ì€ ì»¤ë„ì´ Linux capabilitiesë¥¼ ì§€ì›í•´ì•¼ ì‚¬ìš©í•  ìˆ˜ ìžˆë‹¤. ì»¤ë„ì´ í•´ë‹¹ ê¸°ëŠ¥ì„ ì§€ì›í•˜ëŠ”ì§€ í™•ì¸í•˜ë ¤ë©´ `docker info`ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìžˆë‹¤. ë§Œì•½ ì»¤ë„ì—ì„œ ì–´ë–¤ capabilitiyê°€ ë¹„í™œì„±í™” ë˜ìžˆë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì€ ê²½ê³ ê°€ ë°œìƒí•œë‹¤.
```console
WARNING: No swap limit support
```
---

## **ì˜ˆì‹œ**

```bash
docker run -d \
  --memory=512m \
  --cpus=1 \
  your-image
```

ë˜ëŠ” `docker-compose.yml`ì—ì„œ:

```yaml
deploy:
  resources:
    limits:
      memory: 512M
      cpus: '1.0'
```

---

## **ì¡´ìž¬ ì´ìœ (ìžì› ì œí•œ ê¸°ëŠ¥ì´ ì–´ë–»ê²Œ ì“°ì´ëŠ”ì§€)**
> ChatGPA Answer

Resource constraints ê¸°ëŠ¥ì´ ì¡´ìž¬í•˜ëŠ” ì´ìœ ëŠ” **ì»¨í…Œì´ë„ˆê°€ ì‹œìŠ¤í…œ ìžì›ì„ ê³¼ë„í•˜ê²Œ ì‚¬ìš©í•˜ëŠ” ê±¸ ë°©ì§€í•˜ê³ , ì˜ˆì¸¡ ê°€ëŠ¥í•œ ì„±ëŠ¥ì„ ìœ ì§€**í•˜ê¸° ìœ„í•´ì„œ.

### **1. ìžì› ê³ ê°ˆ ë°©ì§€**

ì»¨í…Œì´ë„ˆëŠ” ê¸°ë³¸ì ìœ¼ë¡œ **í˜¸ìŠ¤íŠ¸ ìžì›ì„ ì œí•œ ì—†ì´ ì“¸ ìˆ˜ ìžˆìŒ**.  
ì¦‰, í•˜ë‚˜ì˜ ì»¨í…Œì´ë„ˆê°€ CPUë‚˜ ë©”ëª¨ë¦¬ë¥¼ ë„ˆë¬´ ë§Žì´ ì“°ë©´ **ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆë‚˜ í˜¸ìŠ¤íŠ¸ ì „ì²´ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìžˆë‹¤**.

> ì˜ˆì‹œ: ë©”ëª¨ë¦¬ ì œí•œ ì—†ì´ ëŒë¦¬ë‹¤ê°€ Java ì•± OOM í„°ì§€ë©´, ì „ì²´ ì‹œìŠ¤í…œì´ ë‹¤ìš´ë  ìˆ˜ë„ ìžˆìŒ ðŸ˜±


### **2. ì„œë¹„ìŠ¤ ê°„ ìžì› ê²©ë¦¬ (Multi-tenancy)**

í•˜ë‚˜ì˜ ì„œë²„ì—ì„œ ì—¬ëŸ¬ ì„œë¹„ìŠ¤(í˜¹ì€ íŒ€)ê°€ ì»¨í…Œì´ë„ˆë¡œ ë‚˜ëˆ ì„œ ì“°ëŠ” ê²½ìš°,

- ì„œë¹„ìŠ¤ AëŠ” CPU 1ê°œ
    
- ì„œë¹„ìŠ¤ BëŠ” CPU 0.5ê°œë§Œ
    
- ì„œë¹„ìŠ¤ CëŠ” ìµœëŒ€ ë©”ëª¨ë¦¬ 512MBë§Œ


ì´ëŸ° ì‹ìœ¼ë¡œ ì œí•œì„ ê±¸ì–´ì¤˜ì•¼ **ê³µì •í•˜ê²Œ ìžì›ì„ ë‚˜ëˆ„ê³  ë…ë¦½ì„±**ì„ ìœ ì§€.

### **3. ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ / ìš©ëŸ‰ ê³„íš ì‹œë®¬ë ˆì´ì…˜**

í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ìžì›ì„ ì¼ë¶€ëŸ¬ ì œí•œí•´ì„œ,

- "ì´ ì„œë¹„ìŠ¤ëŠ” ìµœì†Œ CPU 0.5ê°œ, ë©”ëª¨ë¦¬ 256MBë§Œ ìžˆì–´ë„ ìž˜ ë„ëŠ”ì§€?"
    
- "íŠ¸ëž˜í”½ì´ ëª°ë¦´ ë•Œ ì–´ë–¤ ì„œë¹„ìŠ¤ê°€ ë³‘ëª©ì´ ë˜ëŠ”ì§€?"
    

ë¥¼ í™•ì¸í•˜ê³  **í˜„ì‹¤ì ì¸ ë°°í¬ ê³„íšì„ ì„¸ìš¸ ìˆ˜ìžˆë‹¤.**


### **4. Kubernetes ë“± ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ í™˜ê²½ ì—°ë™**

Kubernetesì—ì„œë„ Podì— `resources.requests`ì™€ `resources.limits`ë¥¼ ëª…ì‹œí•˜ê²Œ ë˜ì–´ ìžˆë‹¤.  
ì´ ê°’ë“¤ì„ ê¸°ë°˜ìœ¼ë¡œ **ìŠ¤ì¼€ì¤„ë§, ì˜¤í† ìŠ¤ì¼€ì¼ë§, QoS ë³´ìž¥, ìš°ì„ ìˆœìœ„ ì„¤ì •**ê¹Œì§€ ê°€ëŠ¥í•¨.

```yaml
resources:
  requests:
    memory: "256Mi"
    cpu: "250m"
  limits:
    memory: "512Mi"
    cpu: "500m"
```

ì´ë ‡ê²Œ ì œí•œì„ ì„¤ì •í•˜ì§€ ì•Šìœ¼ë©´, í´ëŸ¬ìŠ¤í„°ì— ìžì› ë‚­ë¹„ë‚˜ ë¹„ì •ìƒ ë™ìž‘ì´ ìƒê¸¸ ìˆ˜ ìžˆìŒ.

### **5. ì•ˆì •ì„± + ë³´ì•ˆ**

ë¦¬ì†ŒìŠ¤ ì œí•œì„ ê±¸ë©´,

- íŠ¹ì • ì»¨í…Œì´ë„ˆê°€ **ì˜ë„ì¹˜ ì•Šê²Œ í­ì£¼í•˜ëŠ” ìƒí™©**ì—ì„œë„ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ëŠ” ì•ˆì „í•˜ê²Œ ë³´í˜¸
    
- **DoS ê³µê²© ì‹œ** ì‹œìŠ¤í…œ ì „ì²´ê°€ ë»—ëŠ” ê±¸ ë§‰ì„ ìˆ˜ ìžˆìŒ
    
- ë©”ëª¨ë¦¬ ì œí•œ(OOM) ì‹œ í•´ë‹¹ ì»¨í…Œì´ë„ˆë§Œ ì£½ê³  ë¡œê·¸ë„ í™•ì¸ ê°€ëŠ¥
    



**Resource constraintsëŠ” ë¶„ì‚° í™˜ê²½ì—ì„œ ì•ˆì •ì„±, ì„±ëŠ¥ ì˜ˆì¸¡, ìžì› ë¶„ë°°ë¥¼ ìœ„í•œ í•µì‹¬ì ì¸ ì œì–´ ìˆ˜ë‹¨**

---
## **Memory**
### **ë¦¬ëˆ…ìŠ¤ì—ì„œ Docker ì»¨í…Œì´ë„ˆê°€ ì‹œìŠ¤í…œ ë©”ëª¨ë¦¬ë¥¼ ê³¼ë„í•˜ê²Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ë°©ì§€í•´ì•¼ í•˜ëŠ” ì´ìœ **
- ë¦¬ëˆ…ìŠ¤ í˜¸ìŠ¤íŠ¸ì—ì„œëŠ” ì¤‘ìš”í•œ ì‹œìŠ¤í…œ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•  ë©”ëª¨ë¦¬ê°€ ë¶€ì¡±í•˜ë©´ ì»¤ë„ì´ OOME(Out Of Memory Exception) ì„ ë°œìƒì‹œí‚¤ê³ , ë©”ëª¨ë¦¬ë¥¼ í™•ë³´í•˜ê¸° ìœ„í•´ í”„ë¡œì„¸ìŠ¤ë¥¼ ê°•ì œ ì¢…ë£Œí•œë‹¤.
- ì´ë•Œ Dockerë‚˜ ë‹¤ë¥¸ ì¤‘ìš”í•œ ì‹œìŠ¤í…œ í”„ë¡œì„¸ìŠ¤ë„ ì¢…ë£Œ ëŒ€ìƒì´ ë  ìˆ˜ ìžˆì–´, ì‹œìŠ¤í…œ ì „ì²´ê°€ ë¶ˆì•ˆì •í•´ì§€ê±°ë‚˜ ë‹¤ìš´ë  ìˆ˜ ìžˆìŒ.
### **Dockerê°€ OOME ë¦¬ìŠ¤í¬ë¥¼ ì™„í™”ì‹œí‚¤ëŠ” ê¸°ë³¸ ë§¤ì»¤ë‹ˆì¦˜(ì»¨í…Œì´ë„ˆë³´ë‹¤ ë°ëª¬)**
- DockerëŠ” **Docker ë°ëª¬ì˜ OOM ìš°ì„ ìˆœìœ„**ë¥¼ ë‚®ê²Œ ì„¤ì •í•˜ì—¬, ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ë³´ë‹¤ **ì£½ì§€ ì•Šë„ë¡ ë³´í˜¸**.
- ê·¸ëŸ¬ë‚˜ **ê°œë³„ ì»¨í…Œì´ë„ˆì˜ OOM ìš°ì„ ìˆœìœ„ëŠ” ì¡°ì •ë˜ì§€ ì•Šì•„ì„œ**, ë¬¸ì œê°€ ìƒê¸°ë©´ **ì»¨í…Œì´ë„ˆê°€ ë¨¼ì € ì¢…ë£Œ**ë˜ëŠ” ìª½ìœ¼ë¡œ ì„¤ê³„ë˜ì–´ ìžˆìŒ.
- ì´ ë³´í˜¸ ê¸°ëŠ¥ì„ ë¬´ì‹œí•˜ê³  `--oom-score-adj` ê°’ì„ ê·¹ë‹¨ì ìœ¼ë¡œ ë‚®ê²Œ(extreme negative number) ì„¤ì •í•˜ê±°ë‚˜, `--oom-kill-disable` ì˜µì…˜ì„ ì‚¬ìš©í•´ì„œ ì»¨í…Œì´ë„ˆì˜ ì¢…ë£Œë¥¼ ë°©ì§€í•˜ë ¤ê³  í•˜ëŠ” ê²ƒì€ **ê¶Œìž¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤**.

### **ë‹¤ìŒê³¼ ê°™ì€ ë°©ì‹ìœ¼ë¡œ OOME ë¦¬ìŠ¤í¬ë¥¼ ì™„í™”**
- ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë©”ëª¨ë¦¬ ìš”êµ¬ëŸ‰ì„ ì‚¬ì „ì— í…ŒìŠ¤íŠ¸í•´ì„œ íŒŒì•….
- ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì¶©ë¶„í•œ ë¦¬ì†ŒìŠ¤ë¥¼ ê°€ì§„ í˜¸ìŠ¤íŠ¸ì—ì„œë§Œ ì‹¤í–‰.
-  ì»¨í…Œì´ë„ˆê°€ ì‚¬ìš©í•  ìˆ˜ ìžˆëŠ” ë©”ëª¨ë¦¬ë¥¼ ì œí•œ (--memory ì˜µì…˜ ë“±).
- Docker í˜¸ìŠ¤íŠ¸ì—ì„œ ìŠ¤ì™‘(swap) ì„¤ì •ì— ì£¼ì˜. ìŠ¤ì™‘ì€ ë©”ëª¨ë¦¬ë³´ë‹¤ ëŠë¦¬ì§€ë§Œ, ì‹œìŠ¤í…œ ë©”ëª¨ë¦¬ê°€ ê³ ê°ˆë˜ëŠ” ê²ƒì„ ëŒ€ë¹„í•´ ë²„í¼ë¥¼ ì œê³µ.
- ì»¨í…Œì´ë„ˆë¥¼ ì„œë¹„ìŠ¤ë¡œ ì „í™˜í•˜ê³ , ì„œë¹„ìŠ¤ ì œì•½ì¡°ê±´ ë° ë…¸ë“œ ë¼ë²¨(node labels) ì„ ì‚¬ìš©í•˜ì—¬, ë©”ëª¨ë¦¬ê°€ ì¶©ë¶„í•œ í˜¸ìŠ¤íŠ¸ì—ì„œë§Œ ì‹¤í–‰ë˜ë„ë¡ ì„¤ì •.
	- ì—¬ê¸°ì„œ 'ì„œë¹„ìŠ¤'ëŠ” ë„ì»¤ ìŠ¤ì›œì—ì„œì˜ ì„œë¹„ìŠ¤ë¥¼ ë§í•œë‹¤. ì¦‰, ë¶„ì‚° ì‹¤í–‰ í•˜ë¼ëŠ” ê²ƒ.

### **ì»¨í…Œì´ë„ˆì˜ ë©”ëª¨ë¦¬ ì ‘ê·¼ ì œí•œ**
ë„ì»¤ëŠ” ë‘ê°€ì§€ë¡œ ì œí•œì´ ê°€ëŠ¥í•¨. **hard** or **soft** memory limits.
- Hard limits: the container **use no more than a fixed amount of memory**.
- Soft limits: the container **use as much memory as it needs unless certain conditions are met**, such as when the kernel detects low memory or contention on the host machine.

**ë©”ëª¨ë¦¬ ì œì•½ ì„¤ì •í•˜ëŠ” ì˜µì…˜ë“¤ì€ ì•„ëž˜ ë§í¬ ì°¸ì¡°**
> https://docs.docker.com/engine/containers/resource_constraints/#limit-a-containers-access-to-memory


## **CPU**
í˜¸ìŠ¤íŠ¸ ë¨¸ì‹ ì˜ CPU ì‚¬ì´í´ì— ëŒ€í•œ ì§€ì •ëœ ì»¨í…Œì´ë„ˆì˜ ì•¡ì„¸ìŠ¤ë¥¼ ì œí•œí•˜ê¸° ìœ„í•´ ë‹¤ì–‘í•œ ì œì•½ ì¡°ê±´ì„ ì„¤ì •í•  ìˆ˜ ìžˆë‹¤. ëŒ€ë¶€ë¶„ì˜ ìœ ì €ëŠ” ê¸°ë³¸ Â [default CFS scheduler](https://docs.docker.com/engine/containers/resource_constraints/#configure-the-default-cfs-scheduler)ì„ ì”€. [real-time scheduler](https://docs.docker.com/engine/containers/resource_constraints/#configure-the-real-time-scheduler)ë¥¼ ì„¤ì •í•  ìˆ˜ë„ ìžˆë‹¤.

CFSëŠ” ì¼ë°˜ì ì¸ ë¦¬ëˆ…ìŠ¤ ì»¤ë„ì˜ CPU ìŠ¤ì¼€ì¤„ëŸ¬ìž„. ëª‡ëª‡ runtime flagë“¤ì„ ì‚¬ìš©ì‹œ ì»¨í…Œì´ë„ˆê°€ ê°€ì§€ê³  ìžˆëŠ” CPU ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ëŸ‰ì„ ì„¤ì • í•  ìˆ˜ ìžˆë‹¤. ì´ëŸ° ì„¤ì •ì„ ì‚¬ìš©í•˜ë©´ ë„ì»¤ëŠ” í˜¸ìŠ¤íŠ¸ ì‹œìŠ¤í…œì˜ ì»¨í…Œì´ë„ˆì˜ cgroup ì„¸íŒ…ì„ ìˆ˜ì •í•œë‹¤.

**CPU ì œì•½ ì„¤ì •í•˜ëŠ” ì˜µì…˜ë“¤ì€ ì•„ëž˜ ë§í¬ ì°¸ì¡°**
> https://docs.docker.com/engine/containers/resource_constraints/#cpu